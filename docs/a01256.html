<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>&#x202A;libpcl: &#x202A;Unicode Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">&#x202A;libpcl
   </div>
   <div id="projectbrief">&#x202A;Portable C Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc PageDocLTR-title"><div class="header">
  <div class="headertitle">
<div class="title">&#x202A;Unicode Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p class="DocNodeLTR">Unicode support through portable character strings.</p>
<p><a class="anchor" id="md__Users_andrew_projects_libpcl_doxygen_unicode"></a></p>
<p class="DocNodeLTR">A Portable Character, or Portable Character String, is a platform-specific character for character and string management. On Windows, a <code>pchar_t</code> is always a <code>wchar_t</code> which is encoded as UTF-16. On Unix machines, a <code>pchar_t</code> is a <code>char</code> encoded as UTF-8. The portable character exists so applications can be unicode on either Windows or Unix. It is very important to interact with the Win32 API with <code>UNICODE</code> defined. This causes windows to use the unicode versions (wide <code>wchar_t</code>) of many functions and/or macros. On Unix, there are no special macros or named functions to support unicode since UTF-8 is used.</p>
<h3 class="DocNodeLTR"><a class="anchor" id="autotoc_md20"></a>
Portable Character Naming</h3>
<p class="DocNodeLTR">The naming convention for portable character functions is consistent throughout the PCL library. PCL uses <code>pcs</code> for portable character string, mimicing the standard <code>wcs</code> for wide character string. In addition, the letter <code>p</code> is used where one would find a <code>w</code> for <code>wchar_t</code> functions. All PCL functions or macros begin with <code>pcl_</code> or <code>PCL_</code>, creating a namespace.</p>
<table class="DocNodeLTR" class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">&#x202A;char character  </th><th class="markdownTableHeadNone">&#x202A;wchar_t wide character  </th><th class="markdownTableHeadNone">&#x202A;pchar_t portable character   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&#x202A;strcmp  </td><td class="markdownTableBodyNone">&#x202A;wcscmp  </td><td class="markdownTableBodyNone">&#x202A;pcl_pcscmp   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&#x202A;tolower  </td><td class="markdownTableBodyNone">&#x202A;towlower  </td><td class="markdownTableBodyNone">&#x202A;pcl_toplower   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&#x202A;sprintf  </td><td class="markdownTableBodyNone">&#x202A;swprintf  </td><td class="markdownTableBodyNone">&#x202A;pcl_spprintf   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&#x202A;memcmp  </td><td class="markdownTableBodyNone">&#x202A;wmemcmp  </td><td class="markdownTableBodyNone">&#x202A;pcl_pmemcmp   </td></tr>
</table>
<p class="DocNodeLTR">Almost all of the string functions within PCL provide a "str" and "wcs" version, and then macros are used to map them to the "pcs" version. Many are documented as functions to make it easier to fully document parameters and return values. In these cases, a note indicates that it is actually implemented as a macro.</p>
<h3 class="DocNodeLTR"><a class="anchor" id="autotoc_md21"></a>
Formatted Ouput Specifiers</h3>
<p class="DocNodeLTR">PCL offers three extensions to the standard printf family: <code>%Ps</code> for portable character strings, <code>%Pc</code> for portable characters and <code>%/</code> for the platform-specific path separator. The <code>P</code> is the length modifier while the <code>s</code> or <code>c</code> is the conversion specifier.</p>
<h3 class="DocNodeLTR"><a class="anchor" id="autotoc_md22"></a>
Example</h3>
<p class="DocNodeLTR">Below is an example of using portable character strings with PCL. Assume this is ran at a BASH or DOS prompt: </p><div class="fragment"><div class="line"># &quot;file name&quot; in chinese</div>
<div class="line">shell]# ./print_sizes &quot;文件名&quot;</div>
</div><!-- fragment --><p class="DocNodeLTR">For starters, an application needs to be able to accept UTF-8 or UTF-16 arguments. PCL offers <code>pcl_main</code>, which is <code>main</code> on Unix and <code>wmain</code> on Windows: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * print_sizes.c - Output the size of each UTF-8 encoded newline separated </span></div>
<div class="line"><span class="comment"> * pathname and a total size when complete.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * error checking excluded to simplify example</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00059.html">pcl/init.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00062.html">pcl/io.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00086.html">pcl/stat.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00068.html">pcl/limits.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="a01117.html#gab046e59b4feaefe578285704ec0c905b">pcl_main</a>(<span class="keywordtype">int</span> argc, <a class="code" href="a00104.html#ac114b2b1527c8ae241d37cc15ca7d122">pchar_t</a> **argv)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="a01117.html#ga14907e41025b0abbdc02ef1f892bd9a2">pcl_init</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// use &#39;b&#39; for binary on Windows, no effect on Unix</span></div>
<div class="line">  FILE *fp = <a class="code" href="a01118.html#gaa0e860f8c527c6cdcd47c80ed1f0b081">pcl_fopen</a>(argv[1], <a class="code" href="a00035.html#a1df9ab18a5e5dd2e6d6d3977c35e976c">_P</a>(<span class="stringliteral">&quot;rb&quot;</span>)); </div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">char</span> utf8path[<a class="code" href="a00068.html#a115fcb961c6ded0f9404aa5ff161b39e">PCL_MAXPATH</a>]; </div>
<div class="line">  uint64_t total = 0;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span>(fgets(utf8path, <span class="keyword">sizeof</span>(utf8path), fp))</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// pcl_stat expects a pchar_t string so convert the UTF-8 path to a </span></div>
<div class="line">    <span class="comment">// portable character string. On Unix, this is a fancy strdup since </span></div>
<div class="line">    <span class="comment">// the portable encoding is UTF-8.</span></div>
<div class="line">    <a class="code" href="a00104.html#ac114b2b1527c8ae241d37cc15ca7d122">pchar_t</a> *path = <a class="code" href="a01121.html#gafa1b87428b69658496d7331da10b7796">pcl_utf8_to_pcs</a>(<a class="code" href="a01121.html#gab944b052bd629e46cd250b773b836b65">pcl_strrtrim</a>(utf8path), 0, NULL);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="a01180.html">pcl_stat_t</a> st;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="a00086.html#a8d97e7e5e65e8140ef73bb21ff634500">pcl_stat</a>(path, &amp;st) == 0)</div>
<div class="line">    {</div>
<div class="line">      total += st.<a class="code" href="a01180.html#a54d2158f6808e2cc402feddc76d6240b">size</a>;</div>
<div class="line">      <a class="code" href="a01118.html#ga45ab34ad08cce3f205a3273cf4f3ce1f">pcl_printf</a>(<span class="stringliteral">&quot;%Ps - %lld\n&quot;</span>, path, st.<a class="code" href="a01180.html#a54d2158f6808e2cc402feddc76d6240b">size</a>);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="a01106.html#gab88b901c82e1010555b08ff6d39490f2">pcl_free</a>(path);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  fclose(fp);</div>
<div class="line">  </div>
<div class="line">  printf(<span class="stringliteral">&quot;Total: %lld\n&quot;</span>, total);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p class="DocNodeLTR">First, this example uses <a class="el" href="a01118.html#gaa0e860f8c527c6cdcd47c80ed1f0b081" title="&#x202A;Opens a FILE stream for reading and/or writing.">pcl_fopen</a> which takes a <code>pchar_t</code> <em>file</em> and <em>mode</em>. Behind the scenes, <a class="el" href="a01118.html#gaa0e860f8c527c6cdcd47c80ed1f0b081" title="&#x202A;Opens a FILE stream for reading and/or writing.">pcl_fopen</a> uses <code>_wfopen_s</code> on Windows and <code>fopen</code> on Unix. Thus, the <em>file</em> and <em>mode</em> arguments can be passed straight through to the platform-specific functions without having to translate them. In general, try to always work with portable character strings. Many PCL function parameters take <code>pchar_t*</code> and do not offer a <code>char</code> or <code>wchar_t</code> version. For example, all file system functions (anything dealing with a path) only support <code>pchar_t:</code> like the above <a class="el" href="a01118.html#gaa0e860f8c527c6cdcd47c80ed1f0b081" title="&#x202A;Opens a FILE stream for reading and/or writing.">pcl_fopen</a> and <a class="el" href="a00086.html#a8d97e7e5e65e8140ef73bb21ff634500">pcl_stat</a>.</p>
<p class="DocNodeLTR">After reading each line, the UTF-8 string is converted to a portable character string that is then passed to <a class="el" href="a00086.html#a8d97e7e5e65e8140ef73bb21ff634500">pcl_stat</a>. As stated above, there is no conversion when on Unix since a Unix portable character string is already UTF-8.</p>
<p class="DocNodeLTR">If the <code>pcl_stat</code> succeeds, the <code>path</code> is included in the formatted output. This demostrates using a PCL formatted output extension: <code>%Ps</code>.</p>
<p class="DocNodeLTR">When looking at the above code, all of these dirty details are abstracted away, allowing an application to focus on more important things. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aa00086_html_a8d97e7e5e65e8140ef73bb21ff634500"><div class="ttname"><a href="a00086.html#a8d97e7e5e65e8140ef73bb21ff634500">pcl_stat</a></div><div class="ttdeci">#define pcl_stat(path, stbuf)</div><div class="ttdef"><b>Definition:</b> <a href="a00086_source.html#l00061">stat.h:61</a></div></div>
<div class="ttc" id="aa00086_html"><div class="ttname"><a href="a00086.html">stat.h</a></div></div>
<div class="ttc" id="aa00104_html_ac114b2b1527c8ae241d37cc15ca7d122"><div class="ttname"><a href="a00104.html#ac114b2b1527c8ae241d37cc15ca7d122">pchar_t</a></div><div class="ttdeci">char pchar_t</div><div class="ttdef"><b>Definition:</b> <a href="a00104_source.html#l00053">types.h:53</a></div></div>
<div class="ttc" id="aa01118_html_ga45ab34ad08cce3f205a3273cf4f3ce1f"><div class="ttname"><a href="a01118.html#ga45ab34ad08cce3f205a3273cf4f3ce1f">pcl_printf</a></div><div class="ttdeci">PCL_EXPORT int pcl_printf(const char *format,...)</div><div class="ttdoc">Write a formatted character string to stdout.</div></div>
<div class="ttc" id="aa00059_html"><div class="ttname"><a href="a00059.html">init.h</a></div></div>
<div class="ttc" id="aa01180_html"><div class="ttname"><a href="a01180.html">tag_pcl_stat</a></div><div class="ttdef"><b>Definition:</b> <a href="a00086_source.html#l00221">stat.h:222</a></div></div>
<div class="ttc" id="aa01117_html_gab046e59b4feaefe578285704ec0c905b"><div class="ttname"><a href="a01117.html#gab046e59b4feaefe578285704ec0c905b">pcl_main</a></div><div class="ttdeci">#define pcl_main</div><div class="ttdef"><b>Definition:</b> <a href="a00059_source.html#l00115">init.h:115</a></div></div>
<div class="ttc" id="aa01180_html_a54d2158f6808e2cc402feddc76d6240b"><div class="ttname"><a href="a01180.html#a54d2158f6808e2cc402feddc76d6240b">tag_pcl_stat::size</a></div><div class="ttdeci">int64_t size</div><div class="ttdef"><b>Definition:</b> <a href="a00086_source.html#l00236">stat.h:236</a></div></div>
<div class="ttc" id="aa00068_html"><div class="ttname"><a href="a00068.html">limits.h</a></div></div>
<div class="ttc" id="aa01106_html_gab88b901c82e1010555b08ff6d39490f2"><div class="ttname"><a href="a01106.html#gab88b901c82e1010555b08ff6d39490f2">pcl_free</a></div><div class="ttdeci">void * pcl_free(void *p)</div><div class="ttdoc">Free memory space.</div></div>
<div class="ttc" id="aa01121_html_gab944b052bd629e46cd250b773b836b65"><div class="ttname"><a href="a01121.html#gab944b052bd629e46cd250b773b836b65">pcl_strrtrim</a></div><div class="ttdeci">char * pcl_strrtrim(char *s)</div><div class="ttdoc">Trim whitespace from the back (right) of a string.</div></div>
<div class="ttc" id="aa01118_html_gaa0e860f8c527c6cdcd47c80ed1f0b081"><div class="ttname"><a href="a01118.html#gaa0e860f8c527c6cdcd47c80ed1f0b081">pcl_fopen</a></div><div class="ttdeci">PCL_EXPORT FILE * pcl_fopen(const pchar_t *path, const pchar_t *mode)</div><div class="ttdoc">Opens a FILE stream for reading and/or writing.</div><div class="ttdef"><b>Definition:</b> <a href="a00545_source.html#l00037">fopen.c:37</a></div></div>
<div class="ttc" id="aa00068_html_a115fcb961c6ded0f9404aa5ff161b39e"><div class="ttname"><a href="a00068.html#a115fcb961c6ded0f9404aa5ff161b39e">PCL_MAXPATH</a></div><div class="ttdeci">#define PCL_MAXPATH</div><div class="ttdef"><b>Definition:</b> <a href="a00068_source.html#l00052">limits.h:52</a></div></div>
<div class="ttc" id="aa00062_html"><div class="ttname"><a href="a00062.html">io.h</a></div></div>
<div class="ttc" id="aa01117_html_ga14907e41025b0abbdc02ef1f892bd9a2"><div class="ttname"><a href="a01117.html#ga14907e41025b0abbdc02ef1f892bd9a2">pcl_init</a></div><div class="ttdeci">PCL_EXPORT void pcl_init(void)</div><div class="ttdoc">Initializes the PCL library.</div><div class="ttdef"><b>Definition:</b> <a href="a00527_source.html#l00062">init.c:62</a></div></div>
<div class="ttc" id="aa01121_html_gafa1b87428b69658496d7331da10b7796"><div class="ttname"><a href="a01121.html#gafa1b87428b69658496d7331da10b7796">pcl_utf8_to_pcs</a></div><div class="ttdeci">PCL_EXPORT pchar_t * pcl_utf8_to_pcs(const char *src, size_t src_len, size_t *lenp)</div><div class="ttdoc">Convert a UTF-8 string to a pchar_t string.</div><div class="ttdef"><b>Definition:</b> <a href="a00896_source.html#l00063">utf8_to_pcs.c:63</a></div></div>
<div class="ttc" id="aa00035_html_a1df9ab18a5e5dd2e6d6d3977c35e976c"><div class="ttname"><a href="a00035.html#a1df9ab18a5e5dd2e6d6d3977c35e976c">_P</a></div><div class="ttdeci">#define _P(quote)</div><div class="ttdef"><b>Definition:</b> <a href="a00035_source.html#l00078">defs.h:78</a></div></div>
<!-- HTML footer for doxygen 1.8.20-->
<!-- start footer part -->
</body>
</html>
